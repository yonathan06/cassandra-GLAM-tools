{{#> mainWrapper}}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css" integrity="sha512-MQXduO8IQnJVq1qmySpN87QQkiR1bZHtorbJBD0tzy7/0U9+YIC93QWHeGTEoojMVHWWNkoCp8V6OzVSYrX0oQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js" integrity="sha512-K/oyQtMXpxI4+K0W7H25UopjM8pzq0yrVdFdG21Fh5dBe91I40pDd9A4lzNlHPHBIP2cwZuoxaUSX0GJSObvGA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/plugins/monthSelect/style.min.css" integrity="sha512-V7B1IY1DE/QzU/pIChM690dnl44vAMXBidRNgpw0mD+hhgcgbxHAycRpOCoLQVayXGyrbC+HdAONVsF+4DgrZA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="/js/monthSelect.js"></script>
<style>
	.container {
		padding: 24px 32px;
		display: grid;
		grid-template-columns: repeat(6, 1fr);
		row-gap: 32px;
		column-gap: 24px;
		margin-inline-start: var(--sidebar-width);
	}

	.glam-header {
		grid-column: 1 / 7;
		display: flex;
		justify-content: space-between;
	}
	.glam-data {
		display: grid;
		row-gap: 8px;
	}

	.glam-title {
		font-size: 40px;
		font-weight: 400;
		margin-bottom: 6px;
	}

	.glam-category {
		font-size: 17px;
		display: flex;
		align-items: center;
		margin-bottom: 8px;
	}

	.glam-category a {
		margin-inline-start: 20px;
	}

	.glam-props {
		display: flex;
		align-items: center;
	}

	.glam-country {
		display: flex;
		align-items: center;
		margin-inline-end: 8px;
	}

	.glam-country > img {
		margin-inline-end: 4px;
	}

	.glam-website > a {
		display: flex;
		align-items: center;
	}

	.glam-website > a > img {
		height: 16px;
		margin-inline-end: 4px;
	}

	.lang-select-container {
		margin-top: 12px;
	}

	.report-date-picker {
		grid-column: 1 / 2;
		display: flex;
	}

	.report-date-picker input {
		border: none;
		background: transparent;
		font-size: 16px;
	}

	.glam-search {
		height: 34px;
		grid-column: 2 / 5;
		display: flex;
		flex-grow: 1;
	}

	.glam-search input {
		background: none;
		border: none;
		height: inherit;
		width: 100%;
	}

	.glam-search button {
		height: inherit;
		display: flex;
		align-items: center;
		background: none;
		border: none;
	}

	.export-report {
		display: flex;
		column-gap: 1rem;
		grid-column: 5 / 7;
		justify-content: flex-end;
	}

	.export-report input {
		background: none;
    border: none;
    height: inherit;
    max-width: 100px;
	}

	.data-card {
		position: relative;
		min-height: 100px;
		border-radius: 8px;
		background-color: var(--main);
		padding: 10px 14px;
		row-gap: 6px;
		color: #fff;
		display: flex;
		flex-direction: column;
	}

	.data-card-title {
		font-size: 17px;
		color: inherit;
		text-decoration: none;
	}

	.data-card-title::after {
		content: ' ';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}

	.data-card-number {
		font-size: 26px;
		font-weight: 500;
		margin-top: auto;
	}

	.large-card {
		grid-column: span 2;
		border-radius: 8px;
		height: 288px;
		overflow: hidden;
	}

	.page-card {
		background-color: #fff;
		padding: 24px;
		position: relative;
		display: flex;
		flex-direction: column;
	}

	.page-card>img {
		object-fit: contain;
	}

	.page-card-title {
		font-size: 20px;
		font-weight: 500;
		margin: 0;
	}

	.page-card-btns {
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-top: auto;
	}

	.page-card-btns>.btn {
		width: 82px;
	}

	.views-card>img {
		position: absolute;
		left: 50%;
		transform: translateX(-50%);
		width: 100%;
		top: 54px;
		max-width: 359px;
	}

	.contribution-card>img {
		margin-top: 12px;
	}

	.glam-card-data {
		background-color: var(--main);
		padding: 24px 24px 14px 24px;
		color: #fff;
		height: 50%;
	}

	.glam-card-data>h4 {
		margin: 0;
		font-size: 20px;
		font-weight: 500;
		margin-bottom: 6px;
	}

	.glam-card-media-num {
		font-size: 55px;
		font-weight: 500;
	}

	.glam-card-img {
		height: 50%;
	}

	.glam-card-img>img {
		height: 100%;
		width: 100%;
		object-fit: cover;
	}

	.usage-card>img {
		margin-top: 35px;
	}

	.categories-card>img {
		margin-top: 16px;
	}

	.suggestions-card>img {
		margin-top: 43px;
	}
</style>
<div class="pusher">
	{{> sidebar}}
	<main id="container" class="container">
		<div class="glam-header">
			<div class="glam-data">
				<h1 class="glam-title">{{ glam.fullname }}</h1>
				<div class="glam-category"><span>{{langDict.views.index.categoryTitle}}</span> <a
						href="https://commons.wikimedia.org/wiki/Category:{{glam.category}}" target="_blank">{{glam.category}}</a>
				</div>
				{{#ifOr glam.website glam.country}}
					<div class="glam-props">
						{{#if glam.country}}
							<div class="glam-country">
								<img height="16" src="/assets/icons/countries/{{glam.country}}.png" />
								<span>{{glam.country}}</span>
							</div>
						{{/if}}
						{{#if glam.website}}
							<div class="glam-website"><a href="{{glam.website}}"
									target="_blank"><img height="16" src="/assets/icons/link.svg" />{{glam.website}}</a>
							</div>
						{{/if}}
					</div>
				{{/ifOr}}
			</div>
			<div class="lang-select-container">
				{{> langSelect}}
			</div>
		</div>
		<div class="report-date-picker">
			<input type="date" name="date" id="reportDate">
			<script>
				function getYesterdayDateValue(dateVal = new Date()) {
					let date = dateVal.getDate() - 1;
					if (date < 10) {
						date = '0' + date;
					}
					let month = dateVal.getMonth() + 1;
					if (month < 10) {
						month = '0' + month;
					}
					return `${dateVal.getFullYear()}-${month}-${date}`;
				}
				(() => {
					const dateInput = document.getElementById('reportDate');
					const url = new URL(window.location);
					const todayVal = getYesterdayDateValue();
					dateInput.value = url.searchParams.get('date') || todayVal;
					dateInput.max = todayVal;
					dateInput.addEventListener('change', (e) => {
						url.searchParams.set('date', e.target.value);
						history.pushState({}, '', url);
						location.reload();
					});
				})()
			</script>
		</div>
		<form class="glam-search" id="searchFileForm">
			<button type="submit">
				<img src="/assets/icons/icons-search.svg" />
			</button>
			<input type="text" name="fileName" aria-label="{{langDict.views.index.searchFile}}"
				placeholder="{{langDict.views.index.searchFile}}">
		</form>
		<div class="export-report">
			<input placeholder="Select month" id="reportInput" type="text" name="report" />
			<button id="downloadReportBtn" class="btn btn-primary">Download report</button>
			<script type="module">
				let date;
				flatpickr("#reportInput", {
					onChange: (val) => date = val[0],
					plugins: [
						new monthSelectPlugin({
							shorthand: true,
						})
					]
				});
				const downloadButton = document.getElementById("downloadReportBtn");
				downloadButton.addEventListener("click", async () => {
					if (!date) return;
					downloadButton.disabled = true;
					const originalText = downloadButton.textContent;
					downloadButton.textContent = "Loading..."
					const response = await fetch(
						`/api/report/{{glam.name}}?year=${date.getFullYear()}&month=${date.getMonth()}`
					);
					const file = URL.createObjectURL(await response.blob());
					downloadButton.disabled = false;
					downloadButton.textContent = originalText;
					window.open(file, "_blank").focus();
				});
			</script>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/page-views" class="data-card-title">{{langDict.views.index.report.viewsDate}}</a>
			<div class="data-card-number">{{toLocaleString data.yesterdayMediacount}}</div>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/page-views" class="data-card-title">{{langDict.views.index.report.viewsThisMonth}}</a>
			<div class="data-card-number">{{toLocaleString data.thisMonthMediacount}}</div>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/page-views" class="data-card-title">{{langDict.views.index.report.monthlyAvgViews}}</a>
			<div class="data-card-number">{{toLocaleString data.thisYearMonthlyAvg}}</div>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/category-network"
				class="data-card-title">{{langDict.views.index.report.relatedCategories}}</a>
			<div class="data-card-number">{{toLocaleString data.categoriesCount}}</div>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/usage" class="data-card-title">{{langDict.views.index.report.articleUsage}}</a>
			<div class="data-card-number">{{toLocaleString data.articlesCount}}</div>
		</div>
		<div class="data-card">
			<a href="{{glam.name}}/usage" class="data-card-title">{{langDict.views.index.report.projectsUsage}}</a>
			<div class="data-card-number">{{toLocaleString data.projectsCount}}</div>
		</div>
		<div class="large-card page-card views-card">
			<h4 class="page-card-title">{{langDict.views.index.cards.views.title}}</h4>
			<img src="/assets/img/main-glam-page/views-chart.png" alt="{{langDict.views.index.cards.views.title}}">
			<div class="page-card-btns">
				<a href="{{glam.name}}/page-views" class="btn btn-secondary">{{langDict.views.index.view}}</a>
				<button class="btn btn-primary" data-open-modal data-modal-href="{{glam.name}}/page-views"
					data-modal-title="{{langDict.views.index.cards.views.title}}"
					data-modal-content="{{langDict.views.index.cards.views.inPageDescription}}">{{langDict.learnMore}}</button>
			</div>
		</div>
		<div class="large-card page-card contribution-card">
			<h4 class="page-card-title">{{langDict.views.index.cards.userContribution.title}}</h4>
			<img src="/assets/img/main-glam-page/users-contribution-chart.png"
				alt="{{langDict.views.index.cards.userContribution.title}}">
			<div class="page-card-btns">
				<a href="{{glam.name}}/user-contributions" class="btn btn-secondary">{{langDict.views.index.view}}</a>
				<button class="btn btn-primary" data-open-modal data-modal-href="{{glam.name}}/user-contributions"
					data-modal-title="{{langDict.views.index.cards.userContribution.title}}"
					data-modal-content="{{langDict.views.index.cards.userContribution.inPageDescription}}">{{langDict.learnMore}}</button>
			</div>
		</div>
		<div class="large-card glam-card">
			<div class="glam-card-data">
				<h4>{{langDict.views.index.totalMedia}}</h4>
				<div class="glam-card-media-num">{{toLocaleString data.totalImgNum}}</div>
			</div>
			<div class="glam-card-img">
				<img src="{{glam.image}}" alt="{{glam.fullname}}">
			</div>
		</div>
		<div class="large-card page-card usage-card">
			<h4 class="page-card-title">{{langDict.views.index.cards.usage.title}}</h4>
			<img src="/assets/img/main-glam-page/usage-chart.png" alt="{{langDict.views.index.cards.usage.title}}">
			<div class="page-card-btns">
				<a href="{{glam.name}}/usage" class="btn btn-secondary">{{langDict.views.index.view}}</a>
				<button class="btn btn-primary" data-open-modal data-modal-href="{{glam.name}}/usage"
					data-modal-title="{{langDict.views.index.cards.usage.title}}"
					data-modal-content="{{langDict.views.index.cards.usage.inPageDescription}}">{{langDict.learnMore}}</button>
			</div>
		</div>
		<div class="large-card page-card categories-card">
			<h4 class="page-card-title">{{langDict.views.index.cards.categoryNetwork.title}}</h4>
			<img src="/assets/img/main-glam-page/category-network-chart.png"
				alt="{{langDict.views.index.cards.categoryNetwork.title}}">
			<div class="page-card-btns">
				<a href="{{glam.name}}/category-network" class="btn btn-secondary">{{langDict.views.index.view}}</a>
				<button class="btn btn-primary" data-open-modal data-modal-href="{{glam.name}}/category-network"
					data-modal-title="{{langDict.views.index.cards.categoryNetwork.title}}"
					data-modal-content="{{langDict.views.index.cards.categoryNetwork.inPageDescription}}">{{langDict.learnMore}}</button>
			</div>
		</div>
		<div class="large-card page-card suggestions-card">
			<h4 class="page-card-title">{{langDict.views.index.cards.suggestions.title}}</h4>
			<img src="/assets/img/main-glam-page/suggestions-chart.png"
				alt="{{langDict.views.index.cards.suggestions.title}}">
			<div class="page-card-btns">
				<a href="{{glam.name}}/recommender" class="btn btn-secondary">{{langDict.views.index.view}}</a>
				<button class="btn btn-primary" data-open-modal data-modal-href="{{glam.name}}/recommender"
					data-modal-title="{{langDict.views.index.cards.suggestions.title}}"
					data-modal-content="{{langDict.views.index.cards.suggestions.inPageDescription}}">{{langDict.learnMore}}</button>
			</div>
		</div>
	</main>
</div>
<style>
	.modal-container {
		display: none;
		position: fixed;
		background-color: rgba(0, 0, 0, 0.65);
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		z-index: 100;
		overflow: auto;
	}

	.modal {
		display: flex;
		flex-direction: column;
		position: absolute;
		top: 50%;
		transform: translateY(-50%);
		width: 100%;
		height: auto;
		max-width: 800px;
		padding: 18px 24px 18px 66px;
		border-radius: 10px;
		background-color: var(--main);
		color: #fff;
	}

	.modal-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
	}

	.modal-title {
		font-size: 22px;
		font-weight: 500;
	}

	.modal-exit {
		background: none;
		border: none;
		color: white;
		font-size: 40px;
		cursor: pointer;
	}

	.modal-content {
		margin-top: 20px;
		font-size: 16px;
		padding-inline-end: 44px;
		line-height: 1.43;
	}

	.modal-content h5 {
		margin-bottom: 0;
		font-size: inherit;
	}

	.modal-content a {
		color: inherit;
	}

	.modal-button {
		margin-top: auto;
		display: flex;
		justify-content: flex-end;
		margin-top: 20px;
	}

	.modal-button .btn {
		width: 140px;
		height: 50px;
		font-size: 14px;
		margin-inline-end: 8px;
	}
</style>
<div class="modal-container" id="learnMoreModalContainer">
	<div class="modal" id="learnMoreModal">
		<div class="modal-header">
			<h2 class="modal-title" id="modalTitle"></h2>
			<button class="modal-exit" id="modalExit">&times;</button>
		</div>
		<div class="modal-content" id="modalContent"></div>
		<div class="modal-button">
			<a class="btn btn-white" id="modalLink">{{langDict.viewGraph}}</a>
		</div>
	</div>
</div>
<script>
	const modalContainer = document.querySelector('#learnMoreModalContainer');
	const modalTitle = document.querySelector('#modalTitle');
	const modalContent = document.querySelector('#modalContent');
	const modalLink = document.querySelector('#modalLink');
	const openModalButtons = document.querySelectorAll('[data-open-modal]');
	const mainContainer = document.querySelector('#container');
	const learnMoreModal = document.querySelector('#learnMoreModal');

	function positionModal() {
		const containerLeft = mainContainer.offsetLeft;
		const containerWidth = mainContainer.offsetWidth;
		const modalWidth = learnMoreModal.offsetWidth;
		const leftPadding = (containerWidth - modalWidth) / 2;
		learnMoreModal.style.left = (containerLeft + leftPadding) + 'px';
	}

	function openModal(title, content, href) {
		document.documentElement.style.overflow = 'none';
		modalContainer.style.display = 'block';
		modalTitle.innerText = title;
		modalContent.innerHTML = content;
		modalLink.href = href;
		positionModal();
	}
	function closeModal() {
		document.documentElement.style.overflow = 'auto';
		modalContainer.style.display = 'none';
	}
	document.querySelector('#modalExit').addEventListener('click', () => {
		closeModal();
	})
	modalContainer.addEventListener('click', (e) => {
		if (e.target.id === 'learnMoreModalContainer') {
			closeModal();
		}
	})
	openModalButtons.forEach(button => button.addEventListener('click', (e) => {
		openModal(
			e.target.getAttribute('data-modal-title'),
			e.target.getAttribute('data-modal-content'),
			e.target.getAttribute('data-modal-href'),
		);
	}));
</script>
<script>
	document.querySelector('#searchFileForm').addEventListener('submit', (e) => {
		e.preventDefault();
		let inputVal = e.target.querySelector('input[name="fileName"]').value;
		if (inputVal) {
			inputVal = inputVal.replace(/\s/g, "_");
			window.location.href += "/search/" + inputVal;
		}
	});
</script>
{{/mainWrapper}}